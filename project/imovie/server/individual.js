function unique(r){for(var e,o=[],a={},t=0;null!=(e=r[t]);t++)a[e]||(o.push(e),a[e]=!0);return o}var http=require("http"),factor={directors:[],actors:[],types:[],language:[],address:[]};module.exports.getIndividualMoives=function(r){for(var e in r)factor.directors.push(processString(r[e].douban_movie_director)),factor.actors.push(processString(r[e].douban_movie_actor).replace("更多...","")),factor.types.push(processString(r[e].douban_movie_class)),factor.language.push(processString(r[e].douban_movie_language)),factor.address.push(processString(r[e].douban_movie_place));factor.directors=factor.directors.toString().split(","),factor.actors=factor.actors.toString().replace(/,+/g,",").split(","),factor.types=factor.types.toString().split(","),factor.language=factor.language.toString().split(","),factor.address=factor.address.toString().split(",");var o={};return o.directors=maxArray(staticArray(factor.directors)),o.actors=maxArray(staticArray(factor.actors)),o.types=maxArray(staticArray(factor.types)),o.language=maxArray(staticArray(factor.language)),o.address=maxArray(staticArray(factor.address)),o},module.exports.getSql=function(r,e,o){var a=Number.parseInt(o)-Number.parseInt(e)+1,t='select * from "movie" where douban_movie_lookedman > 5000  and (';for(var n in r.directors)t+="douban_movie_director like '%"+r.directors[n]+"%' or \n";t=t.substr(0,t.length-4)+" or ";for(var n in r.actors)t+="douban_movie_actor like '%"+r.actors[n]+"%' or \n";t=t.substr(0,t.length-4)+") and (";for(var n in r.types)t+="douban_movie_class like '%"+r.types[n]+"%' or \n";t=t.substr(0,t.length-4)+") and (";for(var n in r.language)t+="douban_movie_language like '%"+r.language[n]+"%' or \n";t=t.substr(0,t.length-4)+") and (";for(var n in r.address)t+="douban_movie_place like '%"+r.address[n]+"%' or \n";return t=t.substr(0,t.length-4)+") order by douban_movie_lookedman desc  limit "+a+" offset  "+e};var processString=function(r){return r.toString().replace(/\r/g,"").replace("/ [1,]/g ","").split("/").toString().replace(/\s/g,"")},staticArray=function(r){var e={};for(var o in r)e.hasOwnProperty(r[o])?e[r[o]]++:e[r[o]]=1;return e},maxArray=function(r){var e=[],o=0;for(var a in r)e.push(Number.parseInt(r[a])),o+=Number.parseInt(r[a]);e.sort(function(r,e){return e>r?1:-1});var t=[];for(var a in r)r[a]==e[0]?t.push(a):r[a]==e[1]&&t.push(a);return t};module.exports.getDailySql=function(r,e){r="开心"==r||"幸福"==r||"快乐"==r?"晴阳美亮好漂丽佳谐富兴愉喜悦福":"犹豫"==r||"忧郁"==r||"彷徨"==r||"伤心"==r||"矛盾"==r?"雾霾阴忧郁销魂挠苦愁痛撕裂叹哎闷伤犹豫彷徨伤心":"痛苦"==r||"烦恼"==r||"失落"==r||"不爽"==r||"愁闷"==r||"嫉妒"==r?"雾雨泪血风淋浴痛苦烦恼愁闷嫉妒":"恐惧"==r||"龌龊"==r||"贪婪"==r?"鬼魂恐惧黑暗尸鞭蜈蚣虫怖":"懒惰"==r||"淫欲"==r||"愤怒"==r||"绝望"==r?"害怕淫欲色情黄裸女虐杀抢":"平和"==r||"坚定"==r||"骄傲"==r?"平和鸽坚定骄傲持久笃":"美好";for(var o=r.split(""),a='select * from "movie" where douban_movie_lookedman > 1000  and (',t=0;t<o.length;t++)a+="douban_movie_name like '%"+o[t]+"%' or \n";return a=a.substr(0,a.length-4)+") order by douban_movie_lookedman desc  limit "+e+" offset 0"},module.exports.getThemeSql=function(r,e,o,a,t){var n='select * from "movie" where douban_movie_lookedman > 10  and ';return n+="douban_movie_year like '%"+e+"%' and ",n+="douban_movie_class like '%"+o+"%' and ",n+="douban_movie_language like '%"+a+"%' and ",n+="CAST(douban_movie_score AS double precision) > "+t,n+=" order by douban_movie_lookedman desc  limit "+r+" offset 0"},module.exports.getThemeOneSql=function(r,e){var o='select * from "movie" where douban_movie_lookedman > 10  and ';return o+="douban_movie_class like '%"+e+"%' ",o+=" order by douban_movie_lookedman desc  limit "+r+" offset 0"};